---
# Real Production Test Case from Arpit Garg - Jan 22, 2026
test_case_id: "TC-CALLBACK-001"
date_reported: "2026-01-22"
reported_by: "Arpit Garg"
category: "callback_issues"
severity: "high"
source: "Production"

description: |
  Callbacks were not sent for 3 loads for different message types.
  Customer not receiving webhook notifications for tracking updates.

input:
  ticket_description: "Callbacks not sent for loads on Jan 22, 2026"
  tracking_ids:
    - 626717801  # TRACKING_UPDATE
    - 623705749  # TRACKING_UPDATE_CREATION
    - 625342806  # LOCATION_UPDATE
  date_range:
    start: "2026-01-22"
    end: "2026-01-23"

investigation_queries:
  athena_query: |
    SELECT
      tracking_id,
      message_type,
      error_msg,
      http_response_code,
      attempt_count,
      created_at,
      destination_url
    FROM raw_data_db.callbacks_v2
    WHERE tracking_id IN (626717801, 623705749, 625342806)
      AND error_msg IS NOT NULL
      AND datestr BETWEEN '2026-01-22' AND '2026-01-23'
    ORDER BY created_at DESC

expected_evidence:
  - source: "Athena callbacks_v2"
    finding: "Multiple callback failures across different message types"
    confidence_weight: 0.90

  - source: "Error patterns"
    finding: "Similar timeframe suggests endpoint or auth issue"
    confidence_weight: 0.85

  - source: "HTTP response codes"
    finding: "4xx/5xx errors indicate endpoint unreachable or auth failed"
    confidence_weight: 0.95

expected_root_cause: "callback_delivery_failed"

expected_resolution:
  category: "integration_issue"
  steps:
    - "Check customer webhook endpoint accessibility"
    - "Verify authentication credentials (API key, OAuth token)"
    - "Test webhook endpoint manually with sample payload"
    - "Review error_msg for specific failure reason"
    - "Retry failed callbacks once endpoint restored"

  escalation:
    condition: "If endpoint is up and auth is valid"
    escalate_to: "Integration team"
    reason: "Potential payload format issue or FourKites webhook service degradation"

expected_confidence: 0.85

expected_time_to_investigate: "5-8 minutes"

validation_criteria:
  - "Correctly identifies all 3 tracking_ids"
  - "Queries callbacks_v2 table with correct date range"
  - "Recognizes pattern across multiple loads"
  - "Provides actionable resolution steps"
  - "Includes escalation path if standard fixes don't work"

notes: |
  Common callback failure causes:
  1. Customer endpoint down/unreachable (most common)
  2. Authentication token expired
  3. IP whitelist changes
  4. Certificate expiration (SSL/TLS)
  5. Payload size limits exceeded
  6. Rate limiting by customer firewall

  Resolution typically requires customer action (75% of cases).
