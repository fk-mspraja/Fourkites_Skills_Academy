# Test Case: Network Relationship Missing
# Based on: Real ticket pattern from support team

test_case:
  id: "ocean_network_missing_001"
  name: "Load stuck due to missing network relationship"
  description: |
    Customer reports load U110123982 stuck in 'Awaiting Tracking Info' for 3 days.
    Root cause: No carrier-shipper relationship exists.
    This is the #1 cause of stuck loads (7.7% of all loads).

  category: "load_not_tracking"
  expected_root_cause: "network_relationship_missing"
  expected_confidence: 0.95

  # Input: What the ticket looks like
  ticket:
    id: "SF-12345"
    subject: "Load U110123982 stuck in Awaiting Tracking Info"
    description: |
      Customer reports load is not updating.
      It has been stuck in 'Awaiting Tracking Info' for 3 days.
      Customer calling for update.
    customer: "Walmart"
    created_date: "2026-01-10"
    load_id: "U110123982"

  # Context extracted from ticket
  context:
    load_id: "U110123982"
    carrier_id: "CARR_ACME_123"
    carrier_name: "Acme Trucking"
    shipper_id: "SHIP_WALMART_456"
    shipper_name: "Walmart"
    mode: "OCEAN"
    container_number: "TCNU1234567"
    booking_number: "BK2026010001"

  # Mock API responses for testing
  mock_responses:

    tracking_api.get_load_details:
      exists: true
      id: "U110123982"
      status: "AWAITING_TRACKING_INFO"
      mode: "OCEAN"
      carrier:
        id: "CARR_ACME_123"
        name: "Acme Trucking"
      shipper:
        id: "SHIP_WALMART_456"
        name: "Walmart"
      tracking:
        method: "RPA"
        source: "RPA"
        subscription_id: "JT_SUB_789"

    super_api.get_tracking_config:
      tracking_id: "TRK_001"
      primary_identifier: "booking_number"
      identifier_value: "BK2026010001"
      subscription_id: "JT_SUB_789"
      tracking_source: "RPA"

    redshift.check_network_relationship:
      # Empty result = no relationship exists
      rows: []
      count: 0

    redshift.find_similar_stuck_loads:
      affected_loads: 847
      note: "847 other loads from same carrier also stuck"

  # Expected result
  expected_result:
    root_cause: "network_relationship_missing"
    root_cause_category: "configuration_issue"
    confidence_score: 0.95
    explanation: |
      Carrier-shipper relationship does not exist in system.
      This is the #1 cause of 'Awaiting Tracking Info' (7.7% of loads).
      Found 847 other loads from same carrier also stuck.
    recommended_action:
      action: "create_relationship"
      priority: "immediate"
      human_approval_required: true
    evidence:
      - source: "tracking_api"
        finding: "Load exists, status = AWAITING_TRACKING_INFO"
      - source: "super_api"
        finding: "JT subscription exists, tracking via booking number"
      - source: "redshift"
        finding: "No active carrier-shipper relationship found"
      - source: "redshift"
        finding: "847 similar loads affected"

  # Validation criteria
  validation:
    must_identify_root_cause: true
    must_find_similar_loads: true
    must_recommend_relationship_creation: true
    max_steps: 3
    max_time_seconds: 60
