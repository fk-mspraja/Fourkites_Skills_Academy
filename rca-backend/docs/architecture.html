<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent RCA Platform - Architecture Document</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e8e8e8;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #6a6a6a;
            --border-color: #d0d0d0;
            --accent: #333333;
            --success: #2d5a2d;
            --warning: #5a5a2d;
            --code-bg: #f0f0f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 16px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            padding: 60px 20px;
            background: var(--bg-secondary);
            border-bottom: 3px solid var(--accent);
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            letter-spacing: -1px;
        }

        header .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        header .version {
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        section {
            margin-bottom: 60px;
            padding: 40px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h2 .icon {
            font-size: 1.5rem;
        }

        h3 {
            font-size: 1.3rem;
            margin: 30px 0 15px 0;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.1rem;
            margin: 20px 0 10px 0;
            color: var(--text-secondary);
        }

        p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .highlight-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }

        .highlight-box.problem {
            border-left-color: #666;
            background: #f8f8f8;
        }

        .highlight-box.solution {
            border-left-color: #333;
            background: #f0f0f0;
        }

        .highlight-box h4 {
            margin-top: 0;
            font-weight: 600;
            color: var(--text-primary);
        }

        .mermaid {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 8px;
            margin: 25px 0;
            border: 1px solid var(--border-color);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .metric-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .metric-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .metric-card .label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .metric-card .sublabel {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }

        th, td {
            padding: 14px 18px;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        code {
            background: var(--code-bg);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 25px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .agent-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .agent-card h4 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-card .role {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 12px;
        }

        .agent-card ul {
            margin: 0;
            padding-left: 20px;
        }

        .agent-card li {
            margin: 6px 0;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.active {
            background: #e8e8e8;
            color: #2d5a2d;
            border: 1px solid #2d5a2d;
        }

        .status-badge.planned {
            background: #f0f0f0;
            color: #5a5a2d;
            border: 1px solid #5a5a2d;
        }

        .status-badge.future {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #999;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -33px;
            top: 25px;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            border: 3px solid var(--bg-primary);
        }

        .timeline-item h4 {
            margin-top: 0;
        }

        .comparison-table {
            margin: 25px 0;
        }

        .comparison-table th:first-child {
            width: 30%;
        }

        ul.feature-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        ul.feature-list li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        ul.feature-list li:last-child {
            border-bottom: none;
        }

        ul.feature-list .check {
            color: var(--success);
            font-weight: bold;
        }

        .quote {
            font-style: italic;
            padding: 25px 30px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin: 25px 0;
            position: relative;
        }

        .quote::before {
            content: '"';
            font-size: 4rem;
            position: absolute;
            top: -10px;
            left: 15px;
            color: var(--border-color);
            font-family: Georgia, serif;
        }

        .quote p {
            margin: 0;
            padding-left: 30px;
        }

        .quote .author {
            margin-top: 15px;
            padding-left: 30px;
            color: var(--text-muted);
            font-style: normal;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 60px;
        }

        footer p {
            color: var(--text-muted);
            margin: 0;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }

            section {
                padding: 25px;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .agent-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Multi-Agent RCA Platform</h1>
        <p class="subtitle">
            Intelligent Root Cause Analysis powered by LangGraph Multi-Agent Orchestration
        </p>
        <p class="version">Version 1.0 | Architecture Document | January 2026</p>
    </header>

    <div class="container">
        <!-- Executive Summary -->
        <section>
            <h2><span class="icon">&#9733;</span> Executive Summary</h2>

            <p>
                The Multi-Agent RCA Platform revolutionizes how support engineers investigate tracking issues.
                By leveraging <strong>LangGraph's StateGraph</strong> architecture, we've built a system where
                multiple specialized AI agents collaborate in real-time to diagnose root causes that would
                traditionally take 30-60 minutes of manual investigation.
            </p>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="value">12</div>
                    <div class="label">Specialized Agents</div>
                    <div class="sublabel">Working in parallel</div>
                </div>
                <div class="metric-card">
                    <div class="value">9</div>
                    <div class="label">Data Sources</div>
                    <div class="sublabel">Integrated & queryable</div>
                </div>
                <div class="metric-card">
                    <div class="value">85%</div>
                    <div class="label">Confidence Threshold</div>
                    <div class="sublabel">For auto-determination</div>
                </div>
                <div class="metric-card">
                    <div class="value">&lt;5min</div>
                    <div class="label">Target Resolution</div>
                    <div class="sublabel">vs 30-60min manual</div>
                </div>
            </div>
        </section>

        <!-- The Problem: Randomness in RCA -->
        <section>
            <h2><span class="icon">&#9888;</span> The Problem: Randomness in Manual RCA</h2>

            <div class="highlight-box problem">
                <h4>Why Traditional RCA Fails</h4>
                <p>
                    Root Cause Analysis for logistics tracking issues is inherently <strong>non-deterministic</strong>.
                    The same symptom ("load not tracking") can have dozens of different root causes depending on
                    transport mode, carrier configuration, network relationships, and timing.
                </p>
            </div>

            <h3>The Manual Investigation Anti-Pattern</h3>

            <div class="mermaid">
flowchart LR
    A[Support Ticket] --> B{Random Start?}
    B -->|Engineer A| C[Check Tracking API]
    B -->|Engineer B| D[Check JIRA First]
    B -->|Engineer C| E[Check Logs]
    C --> F{Found Issue?}
    D --> F
    E --> F
    F -->|No| G[Random Next Step]
    G --> H[...30-60 minutes later...]
    H --> I[Maybe Found Root Cause]

    style A fill:#f5f5f5,stroke:#333
    style I fill:#e8e8e8,stroke:#333
    style G fill:#fff,stroke:#999,stroke-dasharray: 5 5
            </div>

            <h3>Key Problems with Random Investigation</h3>

            <table>
                <tr>
                    <th>Problem</th>
                    <th>Impact</th>
                    <th>Frequency</th>
                </tr>
                <tr>
                    <td>No systematic approach</td>
                    <td>Different engineers get different results</td>
                    <td>Every investigation</td>
                </tr>
                <tr>
                    <td>Missing data sources</td>
                    <td>Root cause overlooked</td>
                    <td>~40% of cases</td>
                </tr>
                <tr>
                    <td>No evidence correlation</td>
                    <td>Wrong conclusions</td>
                    <td>~25% of cases</td>
                </tr>
                <tr>
                    <td>Knowledge silos</td>
                    <td>Expertise not shared</td>
                    <td>Constant</td>
                </tr>
                <tr>
                    <td>Context switching</td>
                    <td>10+ tabs, multiple tools</td>
                    <td>Every investigation</td>
                </tr>
            </table>

            <div class="quote">
                <p>
                    "I spent 45 minutes checking carrier files before realizing it was a simple
                    network relationship issue. If I had started there, it would have been 2 minutes."
                </p>
                <div class="author">— Actual Support Engineer Feedback</div>
            </div>
        </section>

        <!-- The Solution: Agentic Architecture -->
        <section>
            <h2><span class="icon">&#9881;</span> The Solution: Collaborative Multi-Agent Architecture</h2>

            <div class="highlight-box solution">
                <h4>Why Multi-Agent?</h4>
                <p>
                    Instead of a single AI trying to do everything, we deploy <strong>specialized agents</strong>
                    that mirror how a team of expert analysts would collaborate. Each agent has domain expertise,
                    and they share findings through a centralized state managed by LangGraph.
                </p>
            </div>

            <h3>High-Level Architecture</h3>

            <div class="mermaid">
flowchart TB
    subgraph Frontend["Next.js Frontend"]
        UI[Investigation UI]
        SSE[SSE Stream Consumer]
        Panels[Data Source Panels]
    end

    subgraph Backend["FastAPI Backend"]
        API["/api/rca/investigate"]

        subgraph LangGraph["LangGraph Orchestrator"]
            State[(InvestigationState)]

            subgraph Agents["Agent Pool"]
                ID[Identifier Agent]
                COORD[Coordinator Agent]
                HYP[Hypothesis Agent]
                SYN[Synthesis Agent]
            end

            subgraph DataAgents["Data Collection Agents"]
                TA[Tracking API]
                RS[Redshift]
                AT[Athena]
                JT[JT Agent]
                SA[Super API]
                NA[Network]
                OE[Ocean Events]
                OT[Ocean Trace]
                CF[Confluence]
                SL[Slack]
                JR[JIRA]
            end
        end
    end

    subgraph DataSources["External Data Sources"]
        TAPI[(Tracking API)]
        RSDB[(Redshift DWH)]
        ATDB[(Athena S3)]
        CHDB[(ClickHouse)]
        CFAPI[(Confluence)]
        SLAPI[(Slack)]
        JRAPI[(JIRA)]
    end

    UI --> API
    API --> State
    State <--> Agents
    State <--> DataAgents
    DataAgents --> DataSources
    API -->|SSE| SSE
    SSE --> Panels

    style State fill:#e8e8e8,stroke:#333,stroke-width:2px
    style LangGraph fill:#f5f5f5,stroke:#333
            </div>

            <h3>Why LangGraph?</h3>

            <table class="comparison-table">
                <tr>
                    <th>Feature</th>
                    <th>Traditional Approach</th>
                    <th>LangGraph Approach</th>
                </tr>
                <tr>
                    <td>State Management</td>
                    <td>Manual, error-prone passing</td>
                    <td>Centralized StateGraph with typed state</td>
                </tr>
                <tr>
                    <td>Agent Coordination</td>
                    <td>Hardcoded sequences</td>
                    <td>Dynamic routing with conditional edges</td>
                </tr>
                <tr>
                    <td>Parallel Execution</td>
                    <td>Complex async handling</td>
                    <td>Native parallel node support</td>
                </tr>
                <tr>
                    <td>Error Recovery</td>
                    <td>Cascading failures</td>
                    <td>Graceful degradation per agent</td>
                </tr>
                <tr>
                    <td>Human-in-the-Loop</td>
                    <td>Bolt-on, awkward</td>
                    <td>First-class HITL nodes</td>
                </tr>
                <tr>
                    <td>Streaming</td>
                    <td>All-or-nothing response</td>
                    <td>Incremental state updates via SSE</td>
                </tr>
            </table>
        </section>

        <!-- State Management -->
        <section>
            <h2><span class="icon">&#9670;</span> State Management: The Heart of Collaboration</h2>

            <p>
                The <code>InvestigationState</code> is a typed dictionary that flows through the entire
                investigation. Every agent reads from and writes to this shared state, enabling true collaboration.
            </p>

            <h3>State Structure</h3>

            <pre><code>class InvestigationState(TypedDict):
    # Input
    issue_text: str
    identifiers: Dict[str, str]  # tracking_id, load_number, etc.

    # Collected Data (from data agents)
    tracking_data: Dict          # From Tracking API
    redshift_data: Dict          # From Redshift DWH
    callbacks_data: Dict         # From Athena
    super_api_data: Dict         # From DataHub
    jt_data: Dict                # From Just Transform
    network_data: Dict           # From Company API
    ocean_events_data: Dict      # From ClickHouse
    confluence_data: Dict        # From Wiki
    jira_data: Dict              # From JIRA
    slack_data: Dict             # From Slack

    # Analysis Results
    hypotheses: List[Hypothesis]
    validated_hypotheses: List[Hypothesis]
    root_cause: Optional[RootCause]
    confidence: float

    # Collaboration
    agent_discussions: List[AgentDiscussion]  # Agent reasoning
    agent_messages: List[AgentMessage]        # Agent actions
    decisions: List[CollaborativeDecision]    # Voting outcomes

    # Control Flow
    iteration_count: int
    max_iterations: int
    needs_human: bool
    human_question: Optional[str]</code></pre>

            <h3>State Flow Diagram</h3>

            <div class="mermaid">
stateDiagram-v2
    [*] --> ExtractIdentifiers
    ExtractIdentifiers --> InitialCollection
    InitialCollection --> Coordinate

    Coordinate --> ExecuteAction: continue
    Coordinate --> Synthesize: conclude
    Coordinate --> RequestHuman: stuck

    ExecuteAction --> FormHypotheses
    FormHypotheses --> Coordinate: low confidence
    FormHypotheses --> Synthesize: high confidence

    Synthesize --> [*]
    RequestHuman --> [*]

    note right of Coordinate
        Coordinator reviews state,
        collects agent proposals,
        makes routing decision
    end note

    note right of FormHypotheses
        Updates hypothesis confidence
        based on accumulated evidence
    end note
            </div>

            <h3>State Accumulation Pattern</h3>

            <p>
                Agents don't overwrite state — they <strong>accumulate</strong> it. This is crucial for
                evidence-based reasoning:
            </p>

            <pre><code># Each agent returns updates that get merged
async def execute(self, state: InvestigationState) -> Dict[str, Any]:
    updates = {"agent_discussions": [], "agent_messages": []}

    # Add observations
    updates["agent_discussions"].append(AgentDiscussion(
        agent=self.name,
        message="[Observation] Found tracking_id=614258134",
        message_type="observation"
    ))

    # Add findings
    updates["tracking_data"] = {"exists": True, "status": "Expired", ...}

    return updates  # Merged into global state by LangGraph</code></pre>
        </section>

        <!-- Agent Collaboration -->
        <section>
            <h2><span class="icon">&#9733;</span> Agent Collaboration Model</h2>

            <h3>The Agents</h3>

            <div class="agent-grid">
                <div class="agent-card">
                    <h4>&#128270; Identifier Agent</h4>
                    <p class="role">Data Extractor</p>
                    <ul>
                        <li>Extracts tracking_id, load_number</li>
                        <li>Identifies transport mode</li>
                        <li>LLM-powered text parsing</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128203; Coordinator Agent</h4>
                    <p class="role">Investigation Facilitator</p>
                    <ul>
                        <li>Summarizes current state</li>
                        <li>Collects agent proposals</li>
                        <li>Makes routing decisions</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128161; Hypothesis Agent</h4>
                    <p class="role">Pattern Analyst</p>
                    <ul>
                        <li>Forms hypotheses from evidence</li>
                        <li>Calculates confidence scores</li>
                        <li>Tracks evidence for/against</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128220; Synthesis Agent</h4>
                    <p class="role">Root Cause Determiner</p>
                    <ul>
                        <li>Evaluates top hypotheses</li>
                        <li>Determines final root cause</li>
                        <li>Generates recommendations</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128225; Tracking API Agent</h4>
                    <p class="role">Customer Data Specialist</p>
                    <ul>
                        <li>Fetches customer-visible data</li>
                        <li>Load status, carrier, shipper</li>
                        <li>Real-time tracking info</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128451; Redshift Agent</h4>
                    <p class="role">Data Warehouse Analyst</p>
                    <ul>
                        <li>Historical validation errors</li>
                        <li>Load creation attempts</li>
                        <li>Pattern analysis</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#128230; Callbacks Agent</h4>
                    <p class="role">Integration Specialist</p>
                    <ul>
                        <li>Webhook delivery history</li>
                        <li>HTTP status analysis</li>
                        <li>Error pattern detection</li>
                    </ul>
                </div>

                <div class="agent-card">
                    <h4>&#127758; Ocean Events Agent</h4>
                    <p class="role">Ocean Logistics Specialist</p>
                    <ul>
                        <li>MMCUW log analysis</li>
                        <li>Container milestones</li>
                        <li>Carrier update processing</li>
                    </ul>
                </div>
            </div>

            <h3>Collaboration Workflow</h3>

            <div class="mermaid">
sequenceDiagram
    participant U as User
    participant C as Coordinator
    participant T as Tracking Agent
    participant R as Redshift Agent
    participant H as Hypothesis Agent
    participant S as Synthesis Agent

    U->>C: Start Investigation
    C->>T: Query load data
    C->>R: Query validation history

    par Parallel Execution
        T-->>C: Load found, status=Expired
        R-->>C: 50 attempts, all successful
    end

    C->>H: Form hypotheses from evidence
    H-->>C: H1: Network issue (60%), H2: Config issue (40%)

    C->>C: Need more evidence for H1
    C->>T: Check carrier relationship
    T-->>C: Relationship exists

    C->>H: Update hypotheses
    H-->>C: H1: Network issue (30%), H2: Config issue (70%)

    alt Confidence >= 85%
        C->>S: Synthesize root cause
        S-->>U: Root Cause: Configuration Issue
    else Confidence < 85%
        C-->>U: Request human input
    end
            </div>

            <h3>Verbose Agent Output Pattern</h3>

            <p>
                Each agent emits structured observations that create an audit trail of reasoning:
            </p>

            <pre><code># Example agent output (Claude Code-style verbose)
[Observation] Found tracking_id=614258134 in state. This is a FourKites internal ID.

[Plan] Will query Tracking API to get customer-visible load data.
       This shows what the customer sees in their dashboard.

[Executing] GET /api/v1/tracking?tracking_ids=614258134

[Finding] Load found in Tracking API!
  • Load Number: 3004075
  • Status: Expired
  • Mode: truck
  • Carrier: Hardy Brothers Inc
  • Shipper: Mountaire Farms

[Query Executed] Tracking API: GET /api/v1/tracking?tracking_ids=614258134
                 Result: 1 results in 1324ms</code></pre>
        </section>

        <!-- Hypothesis-Driven Investigation -->
        <section>
            <h2><span class="icon">&#128161;</span> Hypothesis-Driven Investigation</h2>

            <p>
                Unlike rule-based systems, our platform uses <strong>Bayesian-style evidence accumulation</strong>
                to form and validate hypotheses. This mirrors how expert analysts actually think.
            </p>

            <h3>Hypothesis Model</h3>

            <pre><code>@dataclass
class Hypothesis:
    id: str
    description: str           # "Network relationship not configured"
    category: RootCauseCategory # CONFIGURATION_ISSUE, JT_ISSUE, etc.
    confidence: float          # 0.0 - 1.0
    evidence_for: List[Evidence]
    evidence_against: List[Evidence]
    needs_validation: bool
    validation_queries: List[str]

@dataclass
class Evidence:
    source: str                # "Tracking API", "Redshift", etc.
    finding: str               # Human-readable description
    supports_hypothesis: bool
    weight: float              # How strong is this evidence?</code></pre>

            <h3>Evidence Accumulation Example</h3>

            <div class="mermaid">
flowchart LR
    subgraph Evidence["Evidence Collection"]
        E1[Tracking API: Load Exists]
        E2[Redshift: No Errors]
        E3[Network: Relationship Missing]
        E4[Callbacks: None Sent]
    end

    subgraph H1["Hypothesis: Network Issue"]
        direction TB
        FOR1["+0.3 Load exists but no updates"]
        FOR2["+0.4 Relationship missing"]
        FOR3["+0.2 No callbacks sent"]
        AGAINST1["-0.1 Load was created successfully"]
    end

    E1 --> FOR1
    E3 --> FOR2
    E4 --> FOR3
    E2 --> AGAINST1

    H1 --> CONF["Confidence: 80%"]

    style CONF fill:#e8e8e8,stroke:#333,stroke-width:2px
            </div>

            <h3>Confidence Thresholds</h3>

            <table>
                <tr>
                    <th>Confidence Range</th>
                    <th>Action</th>
                    <th>Rationale</th>
                </tr>
                <tr>
                    <td>≥ 85%</td>
                    <td>Auto-determine root cause</td>
                    <td>Strong evidence, high certainty</td>
                </tr>
                <tr>
                    <td>60% - 84%</td>
                    <td>Continue investigation</td>
                    <td>Promising but needs validation</td>
                </tr>
                <tr>
                    <td>Multiple at 50-60%</td>
                    <td>Request human input</td>
                    <td>Competing hypotheses, need guidance</td>
                </tr>
                <tr>
                    <td>&lt; 50%</td>
                    <td>Explore more data sources</td>
                    <td>Insufficient evidence</td>
                </tr>
            </table>
        </section>

        <!-- Data Sources -->
        <section>
            <h2><span class="icon">&#128451;</span> Data Source Integration</h2>

            <h3>Connected Data Sources</h3>

            <table>
                <tr>
                    <th>Source</th>
                    <th>Type</th>
                    <th>Data Provided</th>
                    <th>Status</th>
                </tr>
                <tr>
                    <td>Tracking API</td>
                    <td>REST API</td>
                    <td>Load status, carrier, shipper, stops</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>Redshift DWH</td>
                    <td>SQL Database</td>
                    <td>Validation errors, historical data</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>Athena (S3)</td>
                    <td>SQL Database</td>
                    <td>Callback history, webhook delivery</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>ClickHouse (SigNoz)</td>
                    <td>Time-series DB</td>
                    <td>Recent logs, MMCUW events</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>Super API (DataHub)</td>
                    <td>REST API</td>
                    <td>Tracking configuration, subscriptions</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>JT (Just Transform)</td>
                    <td>REST API</td>
                    <td>RPA scraping history</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>Confluence</td>
                    <td>REST API</td>
                    <td>Documentation, troubleshooting guides</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>JIRA</td>
                    <td>REST API</td>
                    <td>Related tickets, known bugs</td>
                    <td><span class="status-badge active">Active</span></td>
                </tr>
                <tr>
                    <td>Slack</td>
                    <td>REST API</td>
                    <td>Past discussions, resolutions</td>
                    <td><span class="status-badge planned">Needs Token</span></td>
                </tr>
            </table>

            <h3>Query Execution Model</h3>

            <div class="mermaid">
flowchart TB
    subgraph Parallel["Parallel Data Collection"]
        direction LR
        T[Tracking API<br/>~1.5s]
        R[Redshift<br/>~8s]
        A[Athena<br/>~7s]
        J[JIRA<br/>~2s]
        C[Confluence<br/>~1s]
    end

    Start([Start]) --> Parallel
    Parallel --> Merge{Merge Results}
    Merge --> State[(State)]
    State --> Analysis[Analysis Phase]

    style Start fill:#f5f5f5,stroke:#333
    style Merge fill:#e8e8e8,stroke:#333
    style State fill:#d0d0d0,stroke:#333,stroke-width:2px
            </div>

            <p>
                <strong>Performance:</strong> Parallel execution reduces total query time from
                ~20s (sequential) to ~8s (parallel max latency).
            </p>
        </section>

        <!-- Success Metrics -->
        <section>
            <h2><span class="icon">&#9989;</span> Success Metrics</h2>

            <h3>Current Performance</h3>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="value">12</div>
                    <div class="label">Active Agents</div>
                </div>
                <div class="metric-card">
                    <div class="value">9/10</div>
                    <div class="label">Data Sources Working</div>
                </div>
                <div class="metric-card">
                    <div class="value">&lt;2s</div>
                    <div class="label">Initial Response</div>
                </div>
                <div class="metric-card">
                    <div class="value">100%</div>
                    <div class="label">SSE Streaming</div>
                </div>
            </div>

            <h3>Target Metrics (Production)</h3>

            <table>
                <tr>
                    <th>Metric</th>
                    <th>Current</th>
                    <th>Target</th>
                    <th>Notes</th>
                </tr>
                <tr>
                    <td>Mean Time to Resolution</td>
                    <td>~90 seconds</td>
                    <td>&lt;5 minutes</td>
                    <td>vs 30-60 min manual</td>
                </tr>
                <tr>
                    <td>Auto-Determination Rate</td>
                    <td>~30%</td>
                    <td>&gt;70%</td>
                    <td>Without human input</td>
                </tr>
                <tr>
                    <td>Accuracy (when confident)</td>
                    <td>TBD</td>
                    <td>&gt;90%</td>
                    <td>Validated against human review</td>
                </tr>
                <tr>
                    <td>Data Source Coverage</td>
                    <td>90%</td>
                    <td>100%</td>
                    <td>All sources queryable</td>
                </tr>
                <tr>
                    <td>HITL Response Integration</td>
                    <td>Basic</td>
                    <td>Full Loop</td>
                    <td>Human feedback improves model</td>
                </tr>
            </table>

            <h3>Operational Benefits</h3>

            <ul class="feature-list">
                <li>
                    <span class="check">&#10003;</span>
                    <div>
                        <strong>Consistency:</strong> Every investigation follows the same systematic approach,
                        eliminating variance between engineers.
                    </div>
                </li>
                <li>
                    <span class="check">&#10003;</span>
                    <div>
                        <strong>Transparency:</strong> Full audit trail of agent reasoning, queries executed,
                        and evidence collected.
                    </div>
                </li>
                <li>
                    <span class="check">&#10003;</span>
                    <div>
                        <strong>Parallel Processing:</strong> Multiple data sources queried simultaneously,
                        reducing investigation time.
                    </div>
                </li>
                <li>
                    <span class="check">&#10003;</span>
                    <div>
                        <strong>Knowledge Capture:</strong> Agent reasoning patterns encode institutional
                        knowledge that would otherwise be siloed.
                    </div>
                </li>
                <li>
                    <span class="check">&#10003;</span>
                    <div>
                        <strong>Graceful Degradation:</strong> If one data source fails, investigation
                        continues with available data.
                    </div>
                </li>
            </ul>
        </section>

        <!-- Future Roadmap -->
        <section>
            <h2><span class="icon">&#128640;</span> Future Roadmap</h2>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>Phase 1: Foundation <span class="status-badge active">Complete</span></h4>
                    <p>
                        Core multi-agent architecture with LangGraph, SSE streaming, 9 data sources,
                        hypothesis-driven investigation, HITL support.
                    </p>
                </div>

                <div class="timeline-item">
                    <h4>Phase 2: Enhanced Agents <span class="status-badge planned">In Progress</span></h4>
                    <ul>
                        <li>Network Agent full implementation (company ID resolution)</li>
                        <li>Slack integration with bot token</li>
                        <li>RAG system for Confluence/Slack/JIRA semantic search</li>
                        <li>Improved hypothesis prompts with domain examples</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Phase 3: Learning System <span class="status-badge future">Planned</span></h4>
                    <ul>
                        <li>Feedback loop from HITL responses</li>
                        <li>Pattern learning from resolved cases</li>
                        <li>Auto-generated runbooks</li>
                        <li>Confidence calibration based on outcomes</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Phase 4: Integration <span class="status-badge future">Planned</span></h4>
                    <ul>
                        <li>Salesforce ticket auto-fetch</li>
                        <li>JIRA ticket creation from RCA</li>
                        <li>PagerDuty/Slack alerting</li>
                        <li>Multi-tenant deployment</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Phase 5: Advanced Analytics <span class="status-badge future">Future</span></h4>
                    <ul>
                        <li>Root cause pattern tracking over time</li>
                        <li>Proactive issue detection</li>
                        <li>Carrier/shipper health scoring</li>
                        <li>Predictive maintenance recommendations</li>
                    </ul>
                </div>
            </div>

            <h3>Technical Enhancements Planned</h3>

            <table>
                <tr>
                    <th>Enhancement</th>
                    <th>Description</th>
                    <th>Priority</th>
                </tr>
                <tr>
                    <td>Vector RAG</td>
                    <td>Semantic search for Confluence, Slack, JIRA history</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td>Agent Memory</td>
                    <td>Cross-session learning from past investigations</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td>Custom Decision Trees</td>
                    <td>Mode-specific investigation paths (Ocean vs OTR)</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>Batch Investigation</td>
                    <td>Investigate multiple related loads together</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>Investigation Templates</td>
                    <td>Pre-built flows for common issue types</td>
                    <td>Low</td>
                </tr>
            </table>
        </section>

        <!-- Technical Stack -->
        <section>
            <h2><span class="icon">&#128736;</span> Technical Stack</h2>

            <h3>Backend</h3>
            <ul class="feature-list">
                <li><span class="check">&#10003;</span> <strong>Python 3.10+</strong> with FastAPI for async HTTP</li>
                <li><span class="check">&#10003;</span> <strong>LangGraph</strong> for multi-agent orchestration</li>
                <li><span class="check">&#10003;</span> <strong>Anthropic Claude / Azure OpenAI</strong> for LLM inference</li>
                <li><span class="check">&#10003;</span> <strong>SSE (Server-Sent Events)</strong> for real-time streaming</li>
                <li><span class="check">&#10003;</span> <strong>httpx</strong> for async HTTP clients</li>
                <li><span class="check">&#10003;</span> <strong>psycopg2</strong> for Redshift, <strong>clickhouse-driver</strong> for ClickHouse</li>
            </ul>

            <h3>Frontend</h3>
            <ul class="feature-list">
                <li><span class="check">&#10003;</span> <strong>Next.js 14+</strong> with App Router</li>
                <li><span class="check">&#10003;</span> <strong>React 18</strong> with hooks for state management</li>
                <li><span class="check">&#10003;</span> <strong>Tailwind CSS</strong> with custom dark theme</li>
                <li><span class="check">&#10003;</span> <strong>EventSource API</strong> for SSE consumption</li>
            </ul>

            <h3>Infrastructure</h3>
            <ul class="feature-list">
                <li><span class="check">&#10003;</span> <strong>Docker</strong> containerization</li>
                <li><span class="check">&#10003;</span> <strong>Kubernetes</strong> ready deployment</li>
                <li><span class="check">&#10003;</span> VPN-accessible data sources</li>
            </ul>
        </section>

        <!-- Example Investigation -->
        <section>
            <h2><span class="icon">&#128269;</span> Example Investigation</h2>

            <h3>Scenario: "Load 614258134 not tracking"</h3>

            <div class="mermaid">
sequenceDiagram
    participant User
    participant System
    participant Agents

    User->>System: Submit "Load 614258134 not tracking"
    System->>Agents: Extract identifiers
    Agents-->>System: tracking_id=614258134

    par Parallel Data Collection
        System->>Agents: Query Tracking API
        Agents-->>System: Load found, status=Expired, mode=truck
        System->>Agents: Query Redshift
        Agents-->>System: 50 validations, all successful
        System->>Agents: Query JIRA
        Agents-->>System: 5 related issues found
    end

    System->>Agents: Form hypotheses
    Agents-->>System: H1: Normal expiry (70%), H2: Missing updates (30%)

    System->>Agents: Validate H1
    Note over Agents: Load terminated 2025-12-22<br/>Destination was reached

    Agents-->>System: H1 confidence: 90%
    System->>User: Root Cause: Load naturally expired after delivery
            </div>

            <h3>Agent Output Sample</h3>

            <pre><code>event: agent_discussion
data: {"agent": "Tracking API Agent",
       "message": "[Finding] Load found in Tracking API!\n
         • Load Number: 3004075\n
         • Status: Expired\n
         • Mode: truck\n
         • Carrier: Hardy Brothers Inc\n
         • Shipper: Mountaire Farms"}

event: agent_discussion
data: {"agent": "Redshift Agent",
       "message": "[Finding] Validation data found!\n
         • Total attempts: 50\n
         • Failed: 0\n
         • All validations successful"}

event: hypothesis_update
data: [{"id": "H1",
        "description": "Load naturally expired after delivery",
        "category": "normal_operation",
        "confidence": 0.90,
        "evidence_for": [
          {"source": "Tracking API", "finding": "Status is Expired, terminatedAt set"},
          {"source": "Redshift", "finding": "All validations successful"}
        ]}]</code></pre>
        </section>

        <!-- Conclusion -->
        <section>
            <h2><span class="icon">&#10004;</span> Conclusion</h2>

            <p>
                The Multi-Agent RCA Platform addresses the fundamental randomness in manual root cause analysis
                by introducing a systematic, collaborative approach powered by specialized AI agents. Key takeaways:
            </p>

            <div class="highlight-box solution">
                <h4>Why This Architecture Works</h4>
                <ul style="margin-top: 15px; padding-left: 20px;">
                    <li><strong>Specialization:</strong> Each agent is an expert in its domain, just like a team of analysts</li>
                    <li><strong>Collaboration:</strong> Shared state enables agents to build on each other's findings</li>
                    <li><strong>Evidence-Based:</strong> Hypothesis confidence drives decisions, not gut feelings</li>
                    <li><strong>Transparent:</strong> Every step is logged, queryable, and auditable</li>
                    <li><strong>Adaptable:</strong> New agents and data sources can be added without restructuring</li>
                    <li><strong>Human-in-the-Loop:</strong> When uncertain, the system asks for help rather than guessing</li>
                </ul>
            </div>

            <p>
                By leveraging LangGraph's StateGraph for orchestration and SSE for real-time updates, we've created
                a platform that not only automates investigation but also teaches users how expert analysis works —
                one hypothesis at a time.
            </p>
        </section>
    </div>

    <footer>
        <p>
            Multi-Agent RCA Platform | Architecture Document v1.0 | January 2026
        </p>
        <p style="margin-top: 10px;">
            Built with LangGraph, FastAPI, Next.js, and Claude
        </p>
    </footer>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                mirrorActors: false
            },
            themeVariables: {
                primaryColor: '#f5f5f5',
                primaryTextColor: '#1a1a1a',
                primaryBorderColor: '#333',
                lineColor: '#666',
                secondaryColor: '#e8e8e8',
                tertiaryColor: '#d0d0d0'
            }
        });
    </script>
</body>
</html>
